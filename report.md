# 2019 OS Project 1 - Process Scheduling
> http://rswiki.csie.org/dokuwiki/courses:107_2:project_1

## 設計 Program design
### User Space : main.c --> user.o

The main process first reads in the parameters, and then fork() out several child process at their `ready time R` with specified `time units T` and `CPU affinity`.

After each child was forked, the main process sets its `sched policy` and `sched_priority`.

### Kernel Module : OS_PJ1.c --> OS_PJ1.ko

In order to `record execution time` and `show message in kernel ring buffer`, a kernel module is needed to assist us.

When a child process starts to run, it sends a message including its pid to the module.
When the child process is about to finish, it sends another message.

The kernel module should record its start and finish time respectively, and print them together.

### How to run

    make
    sudo insmod ./OS_PJ1.ko
    sudo ./user.o

    sudo rmmod OS_PJ1

## 範例測資執行結果 Results with given test set
The results of test sets will be demonstrated in the following format:

#### policy_i
<pre>
&#x09;&#x09;|&#x09;output
input&#x09;&#x09;|&#x09;from
&#x09;&#x09;|&#x09;program
................................

output from dmesg
</pre>


### FIFO
#### FIFO_1
<pre>
FIFO&#x09;&#x09;|
5&#x09;&#x09;|
P1 0 500&#x09;|&#x09;P2 2466
P2 0 500&#x09;|&#x09;P1 2465
P3 0 500&#x09;|&#x09;P3 2467
P4 0 500&#x09;|&#x09;P4 2468
P5 0 500&#x09;|&#x09;P5 2469
................................

[ 3770.087394] [Project1] 2465 1556648293.772418693 1556648295.074972999
[ 3776.369806] [Project1] 2467 1556648293.812594915 1556648301.357462488
[ 3776.403488] [Project1] 2466 1556648293.795989321 1556648301.391145299
[ 3776.406318] [Project1] 2468 1556648293.787808269 1556648301.393976649
[ 3776.412794] [Project1] 2469 1556648293.780183312 1556648301.400451478
</pre>

#### FIFO_2
<pre>
FIFO&#x09;&#x09;|
4&#x09;&#x09;|
P1 0 80000&#x09;|&#x09;P1 2523
P2 100 5000&#x09;|&#x09;P2 2526
P3 200 1000&#x09;|&#x09;P3 2529
P4 300 1000&#x09;|&#x09;P4 2530
................................

[ 4294.899125] [Project1] 2523 1556648605.476207886 1556648819.886627910
[ 4305.642753] [Project1] 2529 1556648786.699912023 1556648830.630078731
[ 4306.406738] [Project1] 2530 1556648820.419877323 1556648831.394050698
[ 4326.670555] [Project1] 2526 1556648694.916007509 1556648851.657529746
</pre>

#### FIFO_3
<pre>
FIFO&#x09;&#x09;|
7&#x09;&#x09;|
P1 0 8000&#x09;|&#x09;P1 2578
P2 200 5000&#x09;|&#x09;P2 2579
P3 300 3000&#x09;|&#x09;P3 2581
P4 400 1000&#x09;|&#x09;P4 2582
P5 500 1000&#x09;|&#x09;P6 2584
P6 500 1000&#x09;|&#x09;P5 2583    
P7 600 4000&#x09;|&#x09;P7 2585
................................

[ 4890.102812] [Project1] 2578 1556649395.012616910 1556649415.085704468
[ 4910.345778] [Project1] 2582 1556649416.820350442 1556649435.328653144
[ 4912.062133] [Project1] 2583 1556649417.852265817 1556649437.045004805
[ 4912.082417] [Project1] 2584 1556649417.851729013 1556649437.065290419
[ 4931.141900] [Project1] 2581 1556649416.044070645 1556649456.124762582
[ 4941.461869] [Project1] 2585 1556649419.360148017 1556649466.444726162
[ 4944.541132] [Project1] 2579 1556649415.528382439 1556649469.523989566
</pre>

#### FIFO_4
<pre>
FIFO&#x09;&#x09;|
4&#x09;&#x09;|
P1 0 2000&#x09;|&#x09;P1 2594
P2 500 500&#x09;|&#x09;P3 2603
P3 500 200&#x09;|&#x09;P2 2602
P4 1500 500&#x09;|&#x09;P4 2605
................................

[ 5228.283916] [Project1] 2594 1556649746.604199312 1556649753.267147408
[ 5231.508933] [Project1] 2603 1556649754.680290035 1556649756.492173773
[ 5233.521108] [Project1] 2602 1556649754.684142640 1556649758.504353936
[ 5237.980213] [Project1] 2605 1556649760.091783691 1556649762.963469864
</pre>

#### FIFO_5
<pre>
FIFO&#x09;&#x09;|
7&#x09;&#x09;|
P1 0 8000&#x09;|&#x09;P1 2621
P2 200 5000&#x09;|&#x09;P3 2630
P3 200 3000&#x09;|&#x09;P2 2629
P4 400 1000&#x09;|&#x09;P5 2632
P5 400 1000&#x09;|&#x09;P4 2631
P6 600 1000&#x09;|&#x09;P6 2633
P7 600 4000&#x09;|&#x09;P7 2634
................................

[ 5329.646460] [Project1] 2621 1556649830.167860953 1556649854.629995673
[ 5351.009563] [Project1] 2631 1556649856.931907713 1556649875.993170971
[ 5351.077017] [Project1] 2632 1556649856.928446921 1556649876.060624803
[ 5353.768082] [Project1] 2633 1556649859.684340750 1556649878.751697787
[ 5372.081825] [Project1] 2630 1556649855.176021527 1556649897.065504807
[ 5385.286494] [Project1] 2634 1556649859.688174074 1556649910.270224111
[ 5388.734542] [Project1] 2629 1556649855.179899861 1556649913.718284699
</pre>



### RR
#### RR_1
<pre>
RR&#x09;&#x09;|
5&#x09;&#x09;|
P1 0 500&#x09;|&#x09;P2 2777
P2 0 500&#x09;|&#x09;P1 2776
P3 0 500&#x09;|&#x09;P3 2778
P4 0 500&#x09;|&#x09;P4 2779
P5 0 500&#x09;|&#x09;P5 2780
................................

[ 6000.702492] [Project1] 2776 1556650524.332810372 1556650525.689214950
[ 6008.741070] [Project1] 2779 1556650524.355811705 1556650533.727838798
[ 6008.784459] [Project1] 2780 1556650524.347941294 1556650533.771227442
[ 6008.788498] [Project1] 2778 1556650524.363785777 1556650533.775267471
[ 6008.789884] [Project1] 2777 1556650524.345266130 1556650533.776654610
</pre>

#### RR_2
<pre>
RR&#x09;&#x09;|
2&#x09;&#x09;|
P1 600 4000&#x09;|&#x09;P1 2799
P2 800 5000&#x09;|&#x09;P2 2808
................................

[ 6051.251216] [Project1] 2799 1556650563.855803782 1556650576.238227819
[ 6066.958810] [Project1] 2808 1556650576.752181720 1556650591.945913500
</pre>

#### RR_3
<pre>
RR&#x09;&#x09;|
6&#x09;&#x09;|
P1 1200 5000&#x09;|&#x09;P1 2814
P2 2400 4000&#x09;|&#x09;P2 2825
P3 3600 3000&#x09;|&#x09;P3 2827
P4 4800 7000&#x09;|&#x09;P4 2828
P5 5200 6000&#x09;|&#x09;P5 2829
P6 5800 5000&#x09;|&#x09;P6 2830
................................

[ 6132.462456] [Project1] 2814 1556650642.339956881 1556650657.449929855
[ 6149.068859] [Project1] 2825 1556650660.931959339 1556650674.056438618
[ 6161.440304] [Project1] 2827 1556650676.320254288 1556650686.428023745
[ 6191.053165] [Project1] 2828 1556650688.064518651 1556650716.041469749
[ 6206.476937] [Project1] 2829 1556650690.148324107 1556650731.465540954
[ 6220.064473] [Project1] 2830 1556650694.812182071 1556650745.053333909
</pre>

#### RR_4
<pre>
RR&#x09;&#x09;|
7&#x09;&#x09;|
P1 0 8000&#x09;|&#x09;P1 2838
P2 200 5000&#x09;|&#x09;P2 2848
P3 300 3000&#x09;|&#x09;P3 2849
P4 400 1000&#x09;|&#x09;P4 2850
P5 500 1000&#x09;|&#x09;P5 2851
P6 500 1000&#x09;|&#x09;P6 2852
P7 600 4000&#x09;|&#x09;P7 2853
................................

[ 6351.085811] [Project1] 2838 1556650852.391795231 1556650876.076991642
[ 6370.874428] [Project1] 2848 1556650877.432807863 1556650895.865932536
[ 6384.862048] [Project1] 2849 1556650878.756163250 1556650909.853780339
[ 6390.313475] [Project1] 2850 1556650879.816367574 1556650915.305293149
[ 6391.482630] [Project1] 2852 1556650881.276068335 1556650916.474469518
[ 6391.515232] [Project1] 2851 1556650881.212956956 1556650916.507071207
[ 6404.468465] [Project1] 2853 1556650897.068153840 1556650929.460508019
</pre>

#### RR_5
<pre>
RR&#x09;&#x09;|
7&#x09;&#x09;|
P1 0 8000&#x09;|&#x09;P1 2860
P2 200 5000&#x09;|&#x09;P3 2871
P3 200 3000&#x09;|&#x09;P2 2870
P4 400 1000&#x09;|&#x09;P5 2873
P5 400 1000&#x09;|&#x09;P4 2872
P6 600 1000&#x09;|&#x09;P6 2874
P7 600 4000&#x09;|&#x09;P7 2875
................................

[ 6519.347435] [Project1] 2860 1556651021.316003231 1556651044.341211745
[ 6534.911314] [Project1] 2870 1556651044.784105002 1556651059.905312536
[ 6547.317229] [Project1] 2871 1556651044.780240081 1556651072.311403536
[ 6552.100002] [Project1] 2872 1556651046.303946755 1556651077.094243838
[ 6552.128054] [Project1] 2873 1556651046.296090758 1556651077.122295576
[ 6553.615346] [Project1] 2874 1556651060.727935971 1556651078.609608311
[ 6564.321396] [Project1] 2875 1556651060.732165513 1556651089.315808531
</pre>



### SJF
#### SJF_1
<pre>
SJF&#x09;&#x09;|
4&#x09;&#x09;|
P1 0 7000&#x09;|&#x09;P1 2884
P2 0 2000&#x09;|&#x09;P2 2885
P3 100 1000&#x09;|&#x09;P3 2886
P4 200 4000&#x09;|&#x09;P4 2894
................................

[ 6657.916350] [Project1] 2885 1556651175.468272495 1556651182.912020889
[ 6673.440203] [Project1] 2886 1556651183.452029789 1556651198.436072785
[ 6697.979938] [Project1] 2894 1556651185.184001641 1556651222.976124180
[ 6719.156892] [Project1] 2884 1556651175.472084138 1556651244.153345665
</pre>

#### SJF_2
<pre>
SJF&#x09;&#x09;|
5&#x09;&#x09;|
P1 100 100&#x09;|&#x09;P2 2923
P2 100 4000&#x09;|&#x09;P1 2922
P3 200 200&#x09;|&#x09;P5 2926
P4 200 4000&#x09;|&#x09;P4 2925
P5 200 7000&#x09;|&#x09;P3 2924
................................

[ 6752.417851] [Project1] 2922 1556651277.156273455 1556651277.414717606
[ 6753.565140] [Project1] 2924 1556651278.012516391 1556651278.562019621
[ 6766.566491] [Project1] 2923 1556651277.159926758 1556651291.563530394
[ 6795.479428] [Project1] 2925 1556651278.008597664 1556651320.476817209
[ 6810.349302] [Project1] 2926 1556651278.004286536 1556651335.346868647
</pre>

#### SJF_3
<pre>
SJF&#x09;&#x09;|
8&#x09;&#x09;|
P1 100 3000&#x09;|&#x09;P2 2943
P2 100 5000&#x09;|&#x09;P1 2942
P3 100 7000&#x09;|&#x09;P3 2944
P4 200 10&#x09;|&#x09;P5 2953
P5 200 10&#x09;|&#x09;P4 2952
P6 300 4000&#x09;|&#x09;P6 2954
P7 400 4000&#x09;|&#x09;P7 2955
P8 500 9000&#x09;|&#x09;P8 2956
................................

[ 6856.631722] [Project1] 2942 1556651372.460203975 1556651381.629833631
[ 6857.472835] [Project1] 2952 1556651382.356003515 1556651382.470955989
[ 6857.481097] [Project1] 2953 1556651382.352151998 1556651382.479219929
[ 6904.657334] [Project1] 2954 1556651383.156282695 1556651429.655998596
[ 6920.050982] [Project1] 2955 1556651384.272795951 1556651445.049820765
[ 6926.895462] [Project1] 2943 1556651372.467693780 1556651451.894377980
[ 6941.280781] [Project1] 2944 1556651372.464289014 1556651466.279838113
[ 6952.795122] [Project1] 2956 1556651385.688305339 1556651477.794327077
</pre>

#### SJF_4
<pre>
SJF&#x09;&#x09;|
5&#x09;&#x09;|
P1 0 3000&#x09;|&#x09;P1 2964
P2 1000 1000&#x09;|&#x09;P2 2973
P3 2000 4000&#x09;|&#x09;P3 2974
P4 5000 2000&#x09;|&#x09;P4 2976
P5 7000 1000&#x09;|&#x09;P5 2977
................................

[ 7043.298161] [Project1] 2964 1556651559.176049108 1556651568.298355785
[ 7051.201396] [Project1] 2973 1556651570.891861661 1556651576.201676177
[ 7067.275228] [Project1] 2974 1556651576.183932871 1556651592.275678862
[ 7079.528946] [Project1] 2976 1556651594.687908603 1556651604.529526711
[ 7084.422899] [Project1] 2977 1556651604.536039910 1556651609.423531007
</pre>

#### SJF_5
<pre>
SJF&#x09;&#x09;|
4&#x09;&#x09;|
P1 0 2000&#x09;|&#x09;P1 2983
P2 500 500&#x09;|&#x09;P2 2992
P3 1000 500&#x09;|&#x09;P3 2993
P4 1500 500&#x09;|&#x09;P4 2994
................................

[ 7122.589937] [Project1] 2983 1556651641.215937182 1556651647.590971063
[ 7126.612276] [Project1] 2992 1556651648.936137357 1556651651.613351741
[ 7129.316196] [Project1] 2993 1556651651.642796241 1556651654.317299425
[ 7132.435833] [Project1] 2994 1556651654.299885950 1556651657.436970097

</pre>

### PSJF
#### PSJF_1
<pre>
PSJF&#x09;&#x09;|
4&#x09;&#x09;|
P1 0 10000&#x09;|&#x09;P1 2652
P2 1000 7000&#x09;|&#x09;P2 2662
P3 2000 5000&#x09;|&#x09;P3 2672
P4 3000 3000&#x09;|&#x09;P4 2675
................................

[ 5502.677053] [Project1] 2652 1556649996.764029097 1556650027.661248971
[ 5525.699942] [Project1] 2662 1556650030.075950457 1556650050.684235632
[ 5543.211257] [Project1] 2672 1556650053.304243842 1556650068.195629435
[ 5554.340028] [Project1] 2675 1556650070.780153164 1556650079.324449134
</pre>

#### PSJF_2
<pre>
PSJF&#x09;&#x09;|
5&#x09;&#x09;|
P1 0 3000&#x09;|&#x09;P1 2682
P2 1000 1000&#x09;|&#x09;P2 2690
P3 2000 4000&#x09;|&#x09;P2 2690
P4 5000 2000&#x09;|&#x09;P4 2695
P5 7000 1000&#x09;|&#x09;P5 2697
................................

[ 5643.045215] [Project1] 2682 1556650158.788290099 1556650168.030047702
[ 5648.088817] [Project1] 2690 1556650170.524129675 1556650173.073674674
[ 5667.294999] [Project1] 2691 1556650175.755877630 1556650192.279949176
[ 5675.774240] [Project1] 2695 1556650195.063935989 1556650200.759231666
[ 5685.373243] [Project1] 2697 1556650206.784147472 1556650210.358281520
</pre>

#### PSJF_3
<pre>
PSJF&#x09;&#x09;|
4&#x09;&#x09;|
P1 0 2000&#x09;|&#x09;P1 2704
P2 500 500&#x09;|&#x09;P2 2712
P3 1000 500&#x09;|&#x09;P3 2714
P4 1500 500&#x09;|&#x09;P4 2715
................................

[ 5740.271005] [Project1] 2704 1556650259.092028879 1556650265.256319885
[ 5743.492361] [Project1] 2712 1556650267.052309799 1556650268.477691846
[ 5746.340599] [Project1] 2714 1556650269.788137162 1556650271.325942844
[ 5749.060595] [Project1] 2715 1556650272.679942169 1556650274.045954943
</pre>

#### PSJF_4
<pre>
PSJF&#x09;&#x09;|
4&#x09;&#x09;|
P1 0 7000&#x09;|&#x09;P1 2721
P2 0 2000&#x09;|&#x09;P2 2722
P3 100 1000&#x09;|&#x09;P3 2723
P4 200 4000&#x09;|&#x09;P4 2732
................................

[ 5794.169345] [Project1] 2722 1556650312.516658897 1556650319.154937746
[ 5798.343498] [Project1] 2723 1556650319.696099173 1556650323.329112083
[ 5828.526605] [Project1] 2732 1556650324.160471130 1556650353.512379866
[ 5852.635436] [Project1] 2721 1556650312.528873564 1556650377.621338400
</pre>

#### PSJF_5
<pre>
PSJF&#x09;&#x09;|
5&#x09;&#x09;|
P1 100 100&#x09;|&#x09;P2 2757
P2 100 4000&#x09;|&#x09;P1 2756
P3 200 200&#x09;|&#x09;P5 2760
P4 200 4000&#x09;|&#x09;P4 2759
P5 200 7000&#x09;|&#x09;P3 2758
................................

[ 5884.350894] [Project1] 2756 1556650409.072498200 1556650409.336969621
[ 5885.544233] [Project1] 2758 1556650409.944438497 1556650410.530315443
[ 5899.513413] [Project1] 2757 1556650409.076598550 1556650424.499570174
[ 5931.736307] [Project1] 2759 1556650409.939963688 1556650456.722643000
[ 5947.259818] [Project1] 2760 1556650409.936053053 1556650472.246238590
</pre>

## 結果分析 Result analysis

In FIFO_1, RR_1, and other sets where multiple process get ready at the same time, our scheduler seems to mess up and sees them as not simultaneously ready. But in sets like RR_3 and SJF_1, the orders in the output are the same as theory.

For the finish time, the results of most sets are acceptable. However, in FIFO_1 and RR_1(again), the first process seem to finish earlier than expext(or other processes finish later).

Most problem occurs when process having the same ready time. This may due to the sorting we apply to the processes. If we apply better sorting algorithm(like stable ones), these issues might be handled.

## 組員貢獻 Contributions

- B04201007：write report.md

- B04201020：help debugging, collect results

- B04201021：help debugging, collect results

- B04201043：write report.md

- B05902028：complete the majority of main

- B06901031：build kernel module, structure of project
